---
slug: goner-otel-integration-guide
description: This article details how to integrate OpenTelemetry into the Gone framework to implement distributed tracing, metrics collection, and log management. Through the goner/otel component, your microservices can easily acquire complete observability capabilities, including practical examples and best practice guidelines.
keywords:
  - OpenTelemetry
  - Gone Framework
  - Observability
  - Distributed Tracing
  - Performance Monitoring
  - Microservice Monitoring
  - Go Language
  - Cloud Native
  - System Monitoring
  - Log Management
tags:
  - OpenTelemetry
  - Gone
  - Observability
  - Technical Practice
date: 2025-05-08T11:50
---

# Using goner/otel to Integrate OpenTelemetry

## Background and Significance
[OpenTelemetry](https://opentelemetry.io/) is the de facto standard observability framework in the cloud-native domain, supporting the collection and export of distributed traces, metrics, and logs. It helps developers quickly locate issues and analyze performance bottlenecks in microservice architectures.

[Gone Framework](https://github.com/gone-io/gone) is a dependency injection framework based on Go language, focusing on simplifying service registration, dependency management, and component decoupling. [goner](https://github.com/gone-io/goner) is a component library under the Gone ecosystem, providing common capabilities such as logging, configuration, database, and caching.

Combining OpenTelemetry with Gone framework can give your microservices natural distributed tracing capabilities, greatly improving system observability and operational efficiency.

This article will detail how to elegantly integrate OpenTelemetry through the [goner/otel](https://github.com/gone-io/goner/tree/main/otel) component in Gone framework, and provide practical code examples, answers to common questions, and best practices.

## Quick Start: Five Steps to Integrate OpenTelemetry
![](/img/202505081121-otel-goner-01.gif)

1. Install gonectl scaffold tool:
```bash
go install github.com/gone-io/gonectl@latest
```
2. Create a sample project based on the otel/tracer template:
```bash
gonectl create -t otel/tracer/simple tracer-demo
cd tracer-demo
```
3. Pull dependencies:
```bash
go mod tidy
```
4. Run the example:
```bash
go run .
```
5. View the trace information output in the console.

> You can also install the otel component directly in an existing Gone project:
> ```bash
> gonectl install goner/otel/tracer
> ```

## Running Effect Demonstration

After execution, you will see trace data similar to the following in the console (simplified):
```json5
{
  "Name": "handle-request",
  "SpanContext": {
    "TraceID": "...",
    "SpanID": "..."
  },
  "Events": [
    { "Name": "Start processing request" }
  ],
  "Resource": [
    { "Key": "service.name", "Value": { "Value": "simple demo" } },
    { "Key": "telemetry.sdk.language", "Value": { "Value": "go" } }
  ]
}
```
You can export the data to backends like Jaeger, Zipkin, Prometheus for visualization and analysis.

## Code Analysis and Practice

### Directory Structure Explanation
```bash
tracer-demo/
├── go.mod           # Go module file
├── go.sum           # Dependency verification
├── main.go          # Program entry
├── module.load.go   # Component loading entry (auto-generated)
├── README_CN.md     # Chinese documentation
├── README.md        # English documentation
└── your_component.go# Business component example
```

### Component Loading (module.load.go)
This file is automatically generated by gonectl for registering and loading the goner/otel/tracer component:
```go
// Code generated by gonectl. DO NOT EDIT.
package main
import (
  "github.com/gone-io/gone/v2"
  "github.com/gone-io/goner/g"
  "github.com/gone-io/goner/otel/tracer"
)
var loaders = []gone.LoadFunc{
  tracer.Register,
}
func GoneModuleLoad(loader gone.Loader) error {
  var ops []*g.LoadOp
  for _, f := range loaders {
    ops = append(ops, g.F(f))
  }
  return g.BuildOnceLoadFunc(ops...)(loader)
}
```

### Business Component Example (your_component.go)
```go
package main
import (
  "context"
  "github.com/gone-io/gone/v2"
  "go.opentelemetry.io/otel/trace"
)
type YourComponent struct {
  gone.Flag
  tracer trace.Tracer `gone:"*,otel-tracer"` // Inject OpenTelemetry Tracer
}
func (c *YourComponent) HandleRequest(ctx context.Context) {
  tracer := c.tracer
  ctx, span := tracer.Start(ctx, "handle-request")
  defer span.End()
  span.AddEvent("Start processing request")
  // ...business logic...
}
```

### Program Entry (main.go)
```go
package main
import (
  "context"
  "github.com/gone-io/gone/v2"
  "os"
)
func main() {
  _ = os.Setenv("GONE_OTEL_SERVICE_NAME", "simple demo") // Set service name
  gone.
    Loads(GoneModuleLoad).
    Load(&YourComponent{}).
    Run(func(c *YourComponent) {
      c.HandleRequest(context.Background())
    })
}
```

## Advanced Usage and Best Practices

### Using goner/viper to Read Configuration
- Install goner/viper component:

```bash
gonectl install goner/viper
```
- Add configuration file: config/default.yaml
Configuration content:
```yaml
otel:
    service:
        name: simple demo
```

- Remove the service name setting code in main.go:
```go
//...
func main() {
//   _ = os.Setenv("GONE_OTEL_SERVICE_NAME", "simple demo") // Remove service name setting
// ...
}
```

### Using OLTP/HTTP to Send Trace Data to Jaeger
If console viewing of spans isn't intuitive enough, you can choose to send trace data to Jaeger and view it through the Jaeger UI.

#### Starting Jaeger
Jaeger's official all-in-one is an executable designed for quick local testing. It includes Jaeger UI, jaeger-collector, jaeger-query, jaeger-agent, and an in-memory storage component.

The simplest way to start all-in-one is to use the pre-built image from DockerHub (just one command line).
```bash
docker run --rm --name jaeger \
  -e COLLECTOR_ZIPKIN_HOST_PORT=:9411 \
  -p 6831:6831/udp \
  -p 6832:6832/udp \
  -p 5778:5778 \
  -p 16686:16686 \
  -p 4317:4317 \
  -p 4318:4318 \
  -p 14250:14250 \
  -p 14268:14268 \
  -p 14269:14269 \
  -p 9411:9411 \
  jaegertracing/all-in-one:1.55
```
Then you can open [http://localhost:16686](http://localhost:16686) in your browser to access the Jaeger UI.

The container exposes the following ports:

| Port  | Protocol | Component | Function Description |
|-------|----------|-----------|-------------------------------------------------------------|
| 6831  | UDP      | agent     | Accepts jaeger.thrift (Thrift-compact, used by mainstream SDKs) |
| 6832  | UDP      | agent     | Accepts jaeger.thrift (Thrift-binary, used by Node.js SDK) |
| 5775  | UDP      | agent     | (Deprecated) Accepts zipkin.thrift (Thrift-compact, old clients) |
| 5778  | HTTP     | agent     | Serves configurations (sampling etc.) |
| 16686 | HTTP     | query     | Serves frontend UI |
| 4317  | HTTP     | collector | Accepts OTLP (gRPC protocol) |
| 4318  | HTTP     | collector | Accepts OTLP (HTTP protocol) |
| 14268 | HTTP     | collector | Directly accepts jaeger.thrift client data |
| 14250 | HTTP     | collector | Accepts model.proto |
| 9411  | HTTP     | collector | Zipkin compatible endpoint (optional) |

We'll use port 4318 with HTTP protocol to report trace data.

#### Reporting to Jaeger
1. Install `goner/otel/tracer/http` component:
```bash
gonectl install goner/otel/tracer/http
```

2. Add tracer configuration to the configuration file:
```yaml
otel:
    service:
        name: simple demo
    # Add the following configuration
    tracer:
        http:
            endpoint: localhost:4318
            insecure: true
```
3. Remove the `goner/otel/tracer` component, run `gonectl install goner/otel/tracer` command, uncheck `goner/otel/tracer`:
![](/img/202505081121-otel-goner-02.png)

4. Run the demo project: `go run .`, this time the trace information isn't printed to the console but is sent to Jaeger, so you'll see the program exit directly.

#### View Trace Data in Jaeger UI
Open your browser and visit [http://localhost:16686](http://localhost:16686):
![](/img/202505081121-otel-goner-03.png)
![](/img/202505081121-otel-goner-04.png)

### Frequently Asked Questions (FAQ)

#### 1. Why don't I see any trace data output after integrating goner/otel?
- Verify that the `goner/otel/tracer` component is correctly installed and loaded.
- Check if the service name is set in `main.go` (via environment variable `GONE_OTEL_SERVICE_NAME` or configuration file).
- If using HTTP reporting to Jaeger, ensure Jaeger service is running and endpoint configuration is correct.

#### 2. What should I do if Jaeger UI doesn't show any trace data?
- Confirm that the Jaeger container is running and ports (like 4318, 16686) aren't occupied.
- Check if the `otel.tracer.http.endpoint` in the configuration file matches Jaeger's HTTP collection port (usually `localhost:4318`).
- For remote Jaeger, ensure network connectivity.

#### 3. How to customize the Trace service name?
- Recommended to set service name through configuration file `otel.service.name` or environment variable `GONE_OTEL_SERVICE_NAME`.
- If neither is set, the default service name might be `unknown-service`.

#### 4. No data in console or Jaeger, how to troubleshoot?
- Check if dependencies are completely pulled (`go mod tidy`).
- Look for panic or initialization error logs.
- Try increasing log level to observe detailed output.

#### 5. How to output to both console and Jaeger?
- Currently goner/otel/tracer supports single export target, recommend prioritizing Jaeger for trace analysis.
- For multi-target export, refer to OpenTelemetry official documentation for custom exporter and [goner/otel/tracer documentation](https://github.com/gone-io/goner/blob/main/otel/tracer/README_CN.md#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%BC%E5%87%BA%E5%99%A8).

#### 6. Jaeger collected data is incomplete or lost?
- Check sampling configuration, default is usually full sampling.
- Ensure Jaeger container has sufficient resources to avoid data loss due to insufficient memory.

#### 7. How to add custom events or attributes in business code?
- Use `span.AddEvent("event name")` to add events.
- Use `span.SetAttributes()` to add custom attributes.

#### 8. Which backends does goner/otel support?
- Supports mainstream observability backends like console, Jaeger, Zipkin, Prometheus.
- For specific support details, refer to [goner/otel official documentation](https://github.com/gone-io/goner/tree/main/otel).

### Reference Materials and Further Reading
- [OpenTelemetry Official Documentation](https://opentelemetry.io/docs/)
- [Gone Framework GitHub](https://github.com/gone-io/gone)
- [goner Component Library](https://github.com/gone-io/goner)
- [gonectl Scaffold](https://github.com/gone-io/gonectl)
- [Jaeger Observability Platform](https://www.jaegertracing.io/)

---

Through the above practices, you can quickly integrate OpenTelemetry under Gone framework, enhancing microservice observability and diagnostic capabilities. If you have questions, welcome to raise Issues on GitHub for discussion.